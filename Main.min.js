function random(a,b){var c=b-a;return Math.floor(Math.random()*c+a)}function hatch(){for(var a=new RegExp("00.{"+(width-2)+"}00","g"),b=world.join(""),c=[];null!=(match=a.exec(b));)c.push(match.index);b=null,eggs5=eggs4.slice(),eggs4=eggs3.slice(),eggs3=eggs2.slice(),eggs2=eggs1.slice(),eggs1=c.slice();for(var d=[],e=0;e<eggs1.length;e++){var f=eggs2.indexOf(eggs1[e])>-1?1:0,g=eggs3.indexOf(eggs1[e])>-1?1:0,h=eggs4.indexOf(eggs1[e])>-1?1:0,i=eggs5.indexOf(eggs1[e])>-1?1:0,j=f+g+h+i;4===j&&d.push(eggs1[e])}for(var k=random(0,d.length),l=Math.floor(d[k]/width),m=Math.floor(d[k]%width),e=0;e<world.length;e++){var n=Math.floor(e/width),o=Math.floor(e%width);n!==l&&o!==m||(world[e]=0)}}function random_color(){bgColor=[Math.floor(random(0,255)),Math.floor(random(0,255)),Math.floor(random(0,255))],liveColor=[Math.floor(random(0,255)),Math.floor(random(0,255)),Math.floor(random(0,255))],deadColor=[Math.floor(random(0,255)),Math.floor(random(0,255)),Math.floor(random(0,255))],deadColor2=[Math.floor(Number(deadColor[0]+(bgColor[0]-deadColor[0])*(1/3))),Math.floor(Number(deadColor[1]+(bgColor[1]-deadColor[1])*(1/3))),Math.floor(Number(deadColor[2]+(bgColor[2]-deadColor[2])*(1/3)))],deadColor3=[Math.floor(Number(deadColor[0]+(bgColor[0]-deadColor[0])*(2/3))),Math.floor(Number(deadColor[1]+(bgColor[1]-deadColor[1])*(2/3))),Math.floor(Number(deadColor[2]+(bgColor[2]-deadColor[2])*(2/3)))]}function cycle_colors(){cycle_favs?next_fav():cycle_random&&random_color()}function next_fav(){colorIndex<favorites.array.length-1?colorIndex+=1:colorIndex=0,bgColor=favorites.array[colorIndex].bgColor,liveColor=favorites.array[colorIndex].liveColor,deadColor=favorites.array[colorIndex].deadColor,deadColor2=favorites.array[colorIndex].deadColor2,deadColor3=favorites.array[colorIndex].deadColor3}function shuffle(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a}function reset_cycle(){cycle_colors(),clearInterval(colorCycle),colorCycle=setInterval(cycle_colors,cIntervals[cIntIndex]);var a=document.getElementById("cycle-speed");a.innerHTML="cycle speed "+cIntLabels[cIntIndex]}var unit=8;window.innerHeight>1280&&(unit=Math.floor(8*window.innerHeight/1280)),window.innerWidth>1280&&(unit=Math.floor(8*window.innerWidth/1280));var width=Math.floor(window.innerWidth/unit),height=Math.floor(window.innerHeight/unit),total=width*height,world=[],fps=10,playing,canvas,ctx,counter=0,eggs1=[],eggs2=[],eggs3=[],eggs4=[],eggs5=[],cycle_favs=!0,cycle_random=!1,colorIndex=0,cInterval=1e4,cIntervals=[5e3,1e4,3e4,6e4],cIntLabels=["5s","10s","30s","60s"],cIntIndex=1,colorCycle=setInterval(cycle_colors,cIntervals[cIntIndex]),favorites=window.localStorage.getItem("GoL_colors");if(null===favorites){var bgColor=[255,255,255],liveColor=[0,0,0],deadColor=[255,0,0],deadColor2=[Math.floor(Number(deadColor[0]+(bgColor[0]-deadColor[0])*(1/3))),Math.floor(Number(deadColor[1]+(bgColor[1]-deadColor[1])*(1/3))),Math.floor(Number(deadColor[2]+(bgColor[2]-deadColor[2])*(1/3)))],deadColor3=[Math.floor(Number(deadColor[0]+(bgColor[0]-deadColor[0])*(2/3))),Math.floor(Number(deadColor[1]+(bgColor[1]-deadColor[1])*(2/3))),Math.floor(Number(deadColor[2]+(bgColor[2]-deadColor[2])*(2/3)))],defaultFavs=JSON.stringify({array:[{bgColor:bgColor,liveColor:liveColor,deadColor:deadColor,deadColor2:deadColor2,deadColor3:deadColor3}]});window.localStorage.setItem("GoL_colors",defaultFavs)}else{favorites=JSON.parse(window.localStorage.getItem("GoL_colors")),shuffle(favorites.array);var bgColor=favorites.array[0].bgColor,liveColor=favorites.array[0].liveColor,deadColor=favorites.array[0].deadColor,deadColor2=favorites.array[0].deadColor2,deadColor3=favorites.array[0].deadColor3}var keyTo=[4,3,4,2,4,1,4,0,4,0],keyFrom=[4,4,3,3,2,2,1,1,0,0],goL={init:function(){canvas=document.getElementById("stage"),ctx=canvas.getContext("2d"),canvas.width=width*unit,canvas.height=height*unit;for(var a=0;a<total;a++){var b=0==Math.floor(2*Math.random());b?world.push(9):world.push(0),a===total-1&&(console.log("world ready"),goL.render(),goL.start())}canvas.addEventListener("click",function(a){var b=document.getElementById("menu");b.setAttribute("class","hidden");var c=document.getElementById("controls");c.setAttribute("class","")},!1);var c=document.getElementById("randomize");c.addEventListener("click",random_color,!1);var d=document.getElementById("controls");d.addEventListener("click",function(a){var b=document.getElementById("menu");b.removeAttribute("class");var c=document.getElementById("controls");c.setAttribute("class","open")},!1);var e=document.getElementById("save-fav");e.addEventListener("click",function(a){var b=document.getElementById("color-confirm");b.setAttribute("class","confirm")},!1);var f=document.getElementById("next-fav");f.addEventListener("click",next_fav,!1);var g=document.getElementById("yes");g.addEventListener("click",function(a){var b={bgColor:bgColor,liveColor:liveColor,deadColor:deadColor,deadColor2:deadColor2,deadColor3:deadColor3};favorites.array.push(b),window.localStorage.setItem("GoL_colors",JSON.stringify(favorites));var c=document.getElementById("color-confirm");c.setAttribute("class","confirm hidden")},!1);var h=document.getElementById("no");h.addEventListener("click",function(a){var b=document.getElementById("color-confirm");b.setAttribute("class","confirm hidden")},!1);var i=document.getElementById("cycle-favs"),j=document.getElementById("cycle-random");i.addEventListener("click",function(a){cycle_favs?(cycle_favs=!1,this.innerHTML="cycle favs",j.innerHTML="cycle random"):(cycle_favs=!0,cycle_random=!1,this.innerHTML="&#10003; cycle favs",j.innerHTML="cycle random"),reset_cycle()},!1),j.addEventListener("click",function(a){cycle_random?(cycle_random=!1,this.innerHTML="cycle random",i.innerHTML="cycle favs"):(cycle_random=!0,cycle_favs=!1,this.innerHTML="&#10003; cycle random",i.innerHTML="cycle favs"),reset_cycle()},!1);var k=document.getElementById("cycle-speed");k.addEventListener("click",function(a){cIntIndex<cIntervals.length-1?cIntIndex+=1:cIntIndex=0,reset_cycle()},!1)},render:function(){ctx.restore(),ctx.clearRect(0,0,width*unit,height*unit);for(var a=0;a<world.length;a++){var b=Math.floor(a/width)*unit,c=Math.floor(a%width)*unit,d=keyTo[world[a]];switch(d){case 0:ctx.fillStyle="rgb("+bgColor[0]+","+bgColor[1]+","+bgColor[2]+")";break;case 1:ctx.fillStyle="rgb("+deadColor3[0]+","+deadColor3[1]+","+deadColor3[2]+")";break;case 2:ctx.fillStyle="rgb("+deadColor2[0]+","+deadColor2[1]+","+deadColor2[2]+")";break;case 3:ctx.fillStyle="rgb("+deadColor[0]+","+deadColor[1]+","+deadColor[2]+")";break;case 4:ctx.fillStyle="rgb("+liveColor[0]+","+liveColor[1]+","+liveColor[2]+")"}ctx.fillRect(c,b,unit,unit)}fps||window.requestAnimationFrame(goL.parse_world)},parse_world:function(){for(var a=0;a<world.length;a++){for(var b=a-width-1,c=a-width,d=a-width+1,e=a-1,f=a+1,g=a+width-1,h=a+width,i=a+width+1,j=[b,c,d,e,f,g,h,i],k=[0,0,0,0,0,0,0,0],l=0,m=0;m<j.length;m++){if(j[m]>=0&&j[m]<=world.length)var n=j[m];else if(j[m]<0)var n=j[m]+world.length;else if(j[m]>world.length)var n=j[m]-world.length;m<4?k[m]=keyFrom[world[n]]>3?1:0:k[m]=keyTo[world[n]]>3?1:0,l+=k[m]}var o=keyTo[world[a]],p=keyTo[world[a]];switch(p<4?3===l?o=4:0!==world[a]&&(o-=1):(l<2||l>3)&&(o=3),p){case 4:4===o?world[a]=0:3===o&&(world[a]=1);break;case 3:4===o?world[a]=2:2===o&&(world[a]=3);break;case 2:4===o?world[a]=4:1===o&&(world[a]=5);break;case 1:4===o?world[a]=6:0===o&&(world[a]=7);break;case 0:4===o?world[a]=8:0===o&&(world[a]=9)}}counter<100?counter+=1:(hatch(),counter=0),goL.render()},start:function(){fps?playing=setInterval(goL.parse_world,1e3/fps):window.requestAnimationFrame(goL.parse_world)},stop:function(){clearInterval(playing)}};