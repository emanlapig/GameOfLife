function random(a,b){var c=b-a;return Math.floor(Math.random()*c+a)}var unit=8;window.innerHeight>1280&&(unit=Math.floor(8*window.innerHeight/1280)),window.innerWidth>1280&&(unit=Math.floor(8*window.innerWidth/1280));var width=Math.floor(window.innerWidth/unit),height=Math.floor(window.innerHeight/unit),total=width*height,world=[],fps=12,playing,canvas,ctx,bgColor=[random(0,255),random(0,255),random(0,255)],liveColor=[random(0,255),random(0,255),random(0,255)],deadColor=[random(0,255),random(0,255),random(0,255)],counter=0,eggs1=[],eggs2=[],eggs3=[],eggs4=[],eggs5=[],key_to=[4,3,4,2,4,1,4,0,4,0],key_from=[4,4,3,3,2,2,1,1,0,0],deadColor2=[Math.floor(Number(deadColor[0]+(bgColor[0]-deadColor[0])*(1/3))),Math.floor(Number(deadColor[1]+(bgColor[1]-deadColor[1])*(1/3))),Math.floor(Number(deadColor[2]+(bgColor[2]-deadColor[2])*(1/3)))],deadColor3=[Math.floor(Number(deadColor[0]+(bgColor[0]-deadColor[0])*(2/3))),Math.floor(Number(deadColor[1]+(bgColor[1]-deadColor[1])*(2/3))),Math.floor(Number(deadColor[2]+(bgColor[2]-deadColor[2])*(2/3)))],goL={init:function(){canvas=document.getElementById("stage"),ctx=canvas.getContext("2d"),canvas.width=width*unit,canvas.height=height*unit;for(var a=0;a<total;a++){var b=0==Math.floor(2*Math.random());b?world.push(9):world.push(0),a===total-1&&(console.log("ready"),goL.render(),goL.start())}},render:function(){ctx.restore(),ctx.clearRect(0,0,width*unit,height*unit);for(var a=0;a<world.length;a++){var b=Math.floor(a/width)*unit,c=Math.floor(a%width)*unit,d=key_to[world[a]];switch(d){case 0:ctx.fillStyle="rgb("+bgColor[0]+","+bgColor[1]+","+bgColor[2]+")";break;case 1:ctx.fillStyle="rgb("+deadColor3[0]+","+deadColor3[1]+","+deadColor3[2]+")";break;case 2:ctx.fillStyle="rgb("+deadColor2[0]+","+deadColor2[1]+","+deadColor2[2]+")";break;case 3:ctx.fillStyle="rgb("+deadColor[0]+","+deadColor[1]+","+deadColor[2]+")";break;case 4:ctx.fillStyle="rgb("+liveColor[0]+","+liveColor[1]+","+liveColor[2]+")"}ctx.fillRect(c,b,unit,unit)}fps||window.requestAnimationFrame(goL.parse_world)},parse_world:function(){for(var a=0;a<world.length;a++){var b=a-1,c=a+1,d=a-width,e=a-width-1,f=a-width+1,g=a+width,h=a+width-1,i=a+width+1,j=world[b]>=0?key_from[world[b]]:0,k=world[c]>=0?key_to[world[c]]:0,l=world[d]>=0?key_from[world[d]]:0,m=world[e]>=0?key_from[world[e]]:0,n=world[f]>=0?key_from[world[f]]:0,o=world[g]>=0?key_to[world[g]]:0,p=world[h]>=0?key_to[world[h]]:0,q=world[i]>=0?key_to[world[i]]:0;j=j>3?1:0,k=k>3?1:0,l=l>3?1:0,m=m>3?1:0,n=n>3?1:0,o=o>3?1:0,p=p>3?1:0,q=q>3?1:0;var r=j+k+l+m+n+o+p+q,s=key_to[world[a]],t=key_to[world[a]];switch(t<4?3===r?s=4:0!==world[a]&&(s-=1):(r<2||r>3)&&(s=3),t){case 4:4===s?world[a]=0:3===s&&(world[a]=1);break;case 3:4===s?world[a]=2:2===s&&(world[a]=3);break;case 2:4===s?world[a]=4:1===s&&(world[a]=5);break;case 1:4===s?world[a]=6:0===s&&(world[a]=7);break;case 0:4===s?world[a]=8:0===s&&(world[a]=9)}}counter<100?counter+=1:goL.hatch(),goL.render()},hatch:function(){for(var a=new RegExp("00.{"+(width-2)+"}00","g"),b=world.join(""),c=[];null!=(match=a.exec(b));)c.push(match.index);b="",eggs5=eggs4.slice(),eggs4=eggs3.slice(),eggs3=eggs2.slice(),eggs2=eggs1.slice(),eggs1=c.slice();for(var d=[],e=0;e<eggs1.length;e++){var f=eggs2.indexOf(eggs1[e])>-1?1:0,g=eggs3.indexOf(eggs1[e])>-1?1:0,h=eggs4.indexOf(eggs1[e])>-1?1:0,i=eggs5.indexOf(eggs1[e])>-1?1:0,j=f+g+h+i;4===j&&d.push(eggs1[e])}for(var k=random(0,d.length),l=Math.floor(d[k]/width),m=Math.floor(d[k]%width),e=0;e<world.length;e++){var n=Math.floor(e/width),o=Math.floor(e%width);n!==l&&o!==m||(world[e]=0)}counter=0},start:function(){fps?playing=setInterval(goL.parse_world,1e3/fps):window.requestAnimationFrame(goL.parse_world)},stop:function(){clearInterval(playing)}};