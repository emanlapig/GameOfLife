function init(){null===favorites?Colors.set_default():(favorites=JSON.parse(window.localStorage.getItem("GoL_colors")),shuffle(favorites.array),bg=favorites.array[0].b,live=favorites.array[0].l,dead=favorites.array[0].d,dead2=favorites.array[0].d2,dead3=favorites.array[0].d3),canvas=document.getElementById("stage"),ctx=canvas.getContext("2d"),canvas.width=width*unit,canvas.height=height*unit;for(var a=0;a<total;a++){var b=0==Math.floor(2*Math.random());b?world.push(9):world.push(0),a===total-1&&(console.log("world ready"),GoL.render(),GoL.start())}btns.randomize=document.getElementById("randomize"),btns.options=document.getElementById("controls"),btns.save=document.getElementById("save-fav"),btns.saveYes=document.getElementById("color-yes"),btns.saveNo=document.getElementById("color-no"),btns.next=document.getElementById("next-fav"),btns.delete=document.getElementById("delete-fav"),btns.delYes=document.getElementById("delete-yes"),btns.delNo=document.getElementById("delete-no"),btns.cycleFavs=document.getElementById("cycle-favs"),btns.cycleRand=document.getElementById("cycle-random"),btns.cycleSpeed=document.getElementById("cycle-speed"),btns.pause=document.getElementById("pause"),btns.countdown=document.getElementById("countdown"),canvas.addEventListener("click",function(a){var b=document.getElementById("menu");b.setAttribute("class","hidden");var c=document.getElementById("controls");c.setAttribute("class","")},!1),btns.options.addEventListener("click",function(a){var b=document.getElementById("menu");b.removeAttribute("class");var c=document.getElementById("controls");c.setAttribute("class","open")},!1),btns.randomize.addEventListener("click",function(a){Colors.random_color(),Colors.cycle_favs&&(Colors.cycle_favs=!1,Colors.cycle_random=!0,btns.cycleFavs.innerHTML="cycle favs",btns.cycleRand.innerHTML="&#10003; cycle random",Cycle.reset())},!1),btns.save.addEventListener("click",function(a){var b=document.getElementById("color-confirm");b.setAttribute("class","confirm")},!1),btns.saveYes.addEventListener("click",function(a){var b={b:bg,l:live,d:dead,d2:dead2,d3:dead3};favorites.array.push(b),Colors.save_ls();var c=document.getElementById("color-confirm");c.setAttribute("class","confirm hidden")},!1),btns.saveNo.addEventListener("click",function(a){var b=document.getElementById("color-confirm");b.setAttribute("class","confirm hidden")},!1),btns.save.innerHTML="save fav ("+favorites.array.length+")",btns.next.addEventListener("click",function(a){Colors.next_fav(),Colors.cycle_random&&(Colors.cycle_favs=!0,Colors.cycle_random=!1,btns.cycleFavs.innerHTML="&#10003; cycle favs",btns.cycleRand.innerHTML="cycle random",Cycle.reset())},!1),btns.delete.addEventListener("click",function(a){var b=document.getElementById("delete-confirm");b.setAttribute("class","confirm")},!1),btns.delYes.addEventListener("click",function(a){favorites.array.splice(Colors.favIndex,1),favorites.array.length<1&&(Colors.favIndex=0,Colors.set_default()),Colors.save_ls(),Colors.next_fav();var b=document.getElementById("delete-confirm");b.setAttribute("class","confirm hidden")},!1),btns.delNo.addEventListener("click",function(a){var b=document.getElementById("delete-confirm");b.setAttribute("class","confirm hidden")},!1),btns.cycleFavs.addEventListener("click",function(a){Colors.cycle_favs?(Colors.cycle_favs=!1,this.innerHTML="cycle favs",btns.cycleRand.innerHTML="cycle random"):(Colors.cycle_favs=!0,Colors.cycle_random=!1,this.innerHTML="&#10003; cycle favs",btns.cycleRand.innerHTML="cycle random"),Colors.go_next()},!1),btns.cycleRand.addEventListener("click",function(a){Colors.cycle_random?(Colors.cycle_random=!1,this.innerHTML="cycle random",btns.cycleFavs.innerHTML="cycle favs"):(Colors.cycle_random=!0,Colors.cycle_favs=!1,this.innerHTML="&#10003; cycle random",btns.cycleFavs.innerHTML="cycle favs"),Colors.go_next()},!1),btns.cycleSpeed.addEventListener("click",function(a){Cycle.cIntIndex<Cycle.cIntervals.length-1?Cycle.cIntIndex+=1:Cycle.cIntIndex=0,Cycle.reset()},!1),btns.pause.addEventListener("click",function(a){pause?(GoL.start(),pause=!1,Cycle.reset(),this.innerHTML="pause"):(GoL.stop(),pause=!0,Cycle.pause(),this.innerHTML="play")},!1)}function hatch(){for(var a=new RegExp("00.{"+(width-2)+"}00","g"),b=world.join(""),c=[];null!=(match=a.exec(b));)c.push(match.index);b=null,eggs5=eggs4.slice(),eggs4=eggs3.slice(),eggs3=eggs2.slice(),eggs2=eggs1.slice(),eggs1=c.slice();for(var d=[],e=0;e<eggs1.length;e++){var f=eggs2.indexOf(eggs1[e])>-1?1:0,g=eggs3.indexOf(eggs1[e])>-1?1:0,h=eggs4.indexOf(eggs1[e])>-1?1:0,i=eggs5.indexOf(eggs1[e])>-1?1:0,j=f+g+h+i;4===j&&d.push(eggs1[e])}if(d.length>0){var k=Math.floor(d.length/2);hRow=Math.floor(d[k]/width),hCol=Math.floor(d[k]%width);for(var e=0;e<world.length;e++){var l=Math.floor(e/width),m=Math.floor(e%width);l!==hRow&&m!==hCol||(world[e]=0)}}}function shuffle(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a}function random(a,b){var c=b-a;return Math.floor(Math.random()*c+a)}var unit=8;window.innerHeight>1280&&(unit=Math.floor(8*window.innerHeight/1280)),window.innerWidth>1280&&(unit=Math.floor(8*window.innerWidth/1280));var width=Math.floor(window.innerWidth/unit),height=Math.floor(window.innerHeight/unit),total=width*height,world=[],fps=10,playing,canvas,ctx,counter=0,eggs1=[],eggs2=[],eggs3=[],eggs4=[],eggs5=[],bg,live,dead,dead2,dead3,pause=!1,btns={},favorites=window.localStorage.getItem("GoL_colors"),keyTo=[4,3,4,2,4,1,4,0,4,0],keyFrom=[4,4,3,3,2,2,1,1,0,0],GoL={render:function(){ctx.restore(),ctx.clearRect(0,0,width*unit,height*unit);for(var a=0;a<world.length;a++){var b=Math.floor(a/width)*unit,c=Math.floor(a%width)*unit,d=keyTo[world[a]];switch(d){case 0:ctx.fillStyle="rgb("+bg[0]+","+bg[1]+","+bg[2]+")";break;case 1:ctx.fillStyle="rgb("+dead3[0]+","+dead3[1]+","+dead3[2]+")";break;case 2:ctx.fillStyle="rgb("+dead2[0]+","+dead2[1]+","+dead2[2]+")";break;case 3:ctx.fillStyle="rgb("+dead[0]+","+dead[1]+","+dead[2]+")";break;case 4:ctx.fillStyle="rgb("+live[0]+","+live[1]+","+live[2]+")"}ctx.fillRect(c,b,unit,unit)}fps||window.requestAnimationFrame(GoL.parse_world)},parse_world:function(){for(var a=0;a<world.length;a++){for(var b=a-width-1,c=a-width,d=a-width+1,e=a-1,f=a+1,g=a+width-1,h=a+width,i=a+width+1,j=[b,c,d,e,f,g,h,i],k=[0,0,0,0,0,0,0,0],l=0,m=0;m<j.length;m++){if(j[m]>=0&&j[m]<=world.length)var n=j[m];else if(j[m]<0)var n=j[m]+world.length;else if(j[m]>world.length)var n=j[m]-world.length;m<4?k[m]=keyFrom[world[n]]>3?1:0:k[m]=keyTo[world[n]]>3?1:0,l+=k[m]}var o=keyTo[world[a]],p=keyTo[world[a]];switch(p<4?3===l?o=4:0!==world[a]&&(o-=1):(l<2||l>3)&&(o=3),p){case 4:4===o?world[a]=0:3===o&&(world[a]=1);break;case 3:4===o?world[a]=2:2===o&&(world[a]=3);break;case 2:4===o?world[a]=4:1===o&&(world[a]=5);break;case 1:4===o?world[a]=6:0===o&&(world[a]=7);break;case 0:4===o?world[a]=8:0===o&&(world[a]=9)}}counter<100?counter+=1:(hatch(),counter=0),GoL.render()},start:function(){fps?playing=setInterval(GoL.parse_world,1e3/fps):window.requestAnimationFrame(GoL.parse_world)},stop:function(){clearInterval(playing)}},Colors={cycle_favs:!0,cycle_random:!1,favIndex:0,go_next:function(){Colors.cycle_favs?Colors.next_fav():Colors.cycle_random&&Colors.random_color()},next_fav:function(){Colors.favIndex<favorites.array.length-1?Colors.favIndex+=1:Colors.favIndex=0,bg=favorites.array[Colors.favIndex].b,live=favorites.array[Colors.favIndex].l,dead=favorites.array[Colors.favIndex].d,dead2=favorites.array[Colors.favIndex].d2,dead3=favorites.array[Colors.favIndex].d3,Cycle.reset()},random_color:function(){bg=[Math.floor(random(0,255)),Math.floor(random(0,255)),Math.floor(random(0,255))],live=[Math.floor(random(0,255)),Math.floor(random(0,255)),Math.floor(random(0,255))],dead=[Math.floor(random(0,255)),Math.floor(random(0,255)),Math.floor(random(0,255))],dead2=[Math.floor(Number(dead[0]+(bg[0]-dead[0])*(1/3))),Math.floor(Number(dead[1]+(bg[1]-dead[1])*(1/3))),Math.floor(Number(dead[2]+(bg[2]-dead[2])*(1/3)))],dead3=[Math.floor(Number(dead[0]+(bg[0]-dead[0])*(2/3))),Math.floor(Number(dead[1]+(bg[1]-dead[1])*(2/3))),Math.floor(Number(dead[2]+(bg[2]-dead[2])*(2/3)))],Cycle.reset()},set_default:function(){bg=[255,255,255],live=[0,0,0],dead=[255,0,0],dead2=[Math.floor(Number(dead[0]+(bg[0]-dead[0])*(1/3))),Math.floor(Number(dead[1]+(bg[1]-dead[1])*(1/3))),Math.floor(Number(dead[2]+(bg[2]-dead[2])*(1/3)))],dead3=[Math.floor(Number(dead[0]+(bg[0]-dead[0])*(2/3))),Math.floor(Number(dead[1]+(bg[1]-dead[1])*(2/3))),Math.floor(Number(dead[2]+(bg[2]-dead[2])*(2/3)))],favorites={array:[{b:bg,l:live,d:dead,d2:dead2,d3:dead3}]},Colors.save_ls()},save_ls:function(){var a=JSON.stringify(favorites);window.localStorage.setItem("GoL_colors",a),btns.save.innerHTML="save fav ("+favorites.array.length+")"}},Cycle={cInterval:1e4,cIntervals:[5e3,1e4,2e4,3e4,6e4],cIntLabels:["5s","10s","20s","30s","60s"],cIntIndex:1,counter:0,reset:function(){clearInterval(cycleInt),cycleInt=setInterval(Colors.go_next,Cycle.cIntervals[Cycle.cIntIndex]),btns.cycleSpeed.innerHTML="cycle speed "+Cycle.cIntLabels[Cycle.cIntIndex],Cycle.reset_counter()},update_counter:function(){Cycle.counter!==Cycle.cIntervals[Cycle.cIntIndex]?Cycle.counter+=1e3:Cycle.counter=0;var a=(Cycle.cIntervals[Cycle.cIntIndex]-Cycle.counter)/1e3;btns.countdown.innerHTML="next: "+a+"s"},reset_counter:function(){Cycle.counter=0;var a=(Cycle.cIntervals[Cycle.cIntIndex]-Cycle.counter)/1e3;btns.countdown.innerHTML="next: "+a+"s",clearInterval(cycleCounterInt),cycleCounterInt=setInterval(Cycle.update_counter,1e3)},pause:function(){clearInterval(cycleInt),clearInterval(cycleCounterInt)}},cycleInt=setInterval(Colors.go_next,Cycle.cIntervals[Cycle.cIntIndex]),cycleCounterInt=setInterval(Cycle.update_counter,1e3);